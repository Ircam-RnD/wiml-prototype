'use strict';

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _socketIoClient = require('socket.io-client');

var _socketIoClient2 = _interopRequireDefault(_socketIoClient);

var _motionInput = require('motion-input');

var _motionInput2 = _interopRequireDefault(_motionInput);

var _wavesLfo = require('waves-lfo');

var lfo = _interopRequireWildcard(_wavesLfo);

var _commonLfoResampler = require('../common/lfo-resampler');

var _commonLfoResampler2 = _interopRequireDefault(_commonLfoResampler);

var _commonLfoSelect = require('../common/lfo-select');

var _commonLfoSelect2 = _interopRequireDefault(_commonLfoSelect);

var _commonLfoDataRecorder = require('../common/lfo-data-recorder');

var _commonLfoDataRecorder2 = _interopRequireDefault(_commonLfoDataRecorder);

var _commonLfoXmmHhmmDecoder = require('../common/lfo-xmm-hhmm-decoder');

var _commonLfoXmmHhmmDecoder2 = _interopRequireDefault(_commonLfoXmmHhmmDecoder);

var AudioContext = window.AudioContext || window.webkitAudioContext || function () {};

// from : http://stackoverflow.com/questions/5916900/how-can-you-detect-the-version-of-a-browser
function getBrowser() {
	var ua = navigator.userAgent,
	    tem,
	    M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
	if (/trident/i.test(M[1])) {
		tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
		return { name: 'IE', version: tem[1] || '' };
	}
	if (M[1] === 'Chrome') {
		tem = ua.match(/\bOPR\/(\d+)/);
		if (tem != null) {
			return { name: 'Opera', version: tem[1] };
		}
	}
	M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];
	if ((tem = ua.match(/version\/(\d+)/i)) != null) {
		M.splice(1, 1, tem[1]);
	}
	return {
		name: M[0],
		version: M[1]
	};
}

//and for os (in case), see : http://stackoverflow.com/questions/9514179/how-to-find-the-operating-system-version-using-javascript

var rads = false;
if (getBrowser().name === 'Chrome') {
	rads = true;
	console.log('switching to rads mode for rotationRate');
}

var recbut = document.querySelector('#rec-but');
var sendbut = document.querySelector('#send-but');
sendbut.disabled = true;
//let trainbut = document.querySelector('#train-but');
var getmodelsbut = document.querySelector('#getmodels-but');
var movelist = document.querySelector('#move-list');
var likeliest = document.querySelector('#likeliest-label-div');

//======================== LFOp's =======================//

var eventIn = new lfo.sources.EventIn({
	frameSize: 6,
	ctx: AudioContext
});

var resampler = new _commonLfoResampler2['default']({});

var dataRecorder = new _commonLfoDataRecorder2['default']({
	column_names: ['accelX', 'accelY', 'accelZ', 'rotX', 'rotY', 'rotZ']
});

var hhmmDecoder = new _commonLfoXmmHhmmDecoder2['default']({});

var select = new _commonLfoSelect2['default']({
	mode: "passthru" // anything else than "include" or "exclude" passes through
});

var inputBpf = new lfo.sinks.Bpf({
	radius: 0,
	min: -4,
	max: 4,
	canvas: document.querySelector('#rawinput-canvas'),
	duration: 1000, // * inputChain.params.hopSize * inputChain.params.period,
	colors: ['#f00', '#0c0', '#33f', '#333', '#333', '#333'] // magnitude : Red, frequency : Green, periodicity : Blue	
});

var likelihoodsSpectro = new lfo.sinks.Spectrogram({
	scale: 1,
	canvas: document.querySelector('#likelihoods-canvas'),
	duration: 1000,
	color: '#333'
});

var statesSpectro = new lfo.sinks.Spectrogram({
	scale: 1,
	canvas: document.querySelector('#states-canvas'),
	duration: 1000,
	color: '#333'
});

eventIn.connect(resampler);

resampler.connect(inputBpf);

resampler.connect(dataRecorder);

resampler.connect(hhmmDecoder);
hhmmDecoder.connect(likelihoodsSpectro);
hhmmDecoder.connect(statesSpectro);

eventIn.start();

//======================================================//

var sensors = new Array(6);
for (var i = 0; i < 6; i++) {
	sensors[i] = 0;
}

var feedInputChain = function feedInputChain(module) {
	if (module.isValid) {

		//*
		_motionInput2['default'].addListener('acceleration', function (val) {
			//inputChain.process(performance.now(), val);
			for (var i = 0; i < 3; i++) {
				sensors[i] = val[i];
			}
			eventIn.process(performance.now(), sensors);
			//console.log(sensors);
		});
		//*/

		//*
		_motionInput2['default'].addListener('rotationRate', function (val) {
			//here compute the equivalent of "spin" :
			var valStd = val.slice(0);
			if (rads) {
				for (var i = 0; i < 3; i++) {
					valStd[i] *= 180 / Math.PI;
				}
			}
			var spin = Math.pow(valStd[0] * valStd[0] + valStd[1] * valStd[1] + valStd[2] * valStd[2], 0.5) * 0.003;
			//inputChain.process(performance.now(), spin);

			// THE REAL CODE :
			for (var i = 0; i < 3; i++) {
				sensors[i + 3] = val[i];
			}
			eventIn.process(performance.now(), sensors);
			//console.log(sensors);
		});
		//*/
	}
};

(function () {
	_motionInput2['default'].init('acceleration',
	//'accelerationIncludingGravity',
	'rotationRate').then(function (modules) {
		var acceleration = modules[0];
		var rotationRate = modules[1];
		feedInputChain(acceleration);
		feedInputChain(rotationRate);
	})['catch'](function (err) {
		return console.error(err.stack);
	});
})();

// ================= socket operations ================== //

//let socket = io.connect('http://169.254.68.117:3000');
var socket = _socketIoClient2['default'].connect(location.host + '/wiml-hhmm');
//let socket = io.connect('127.0.0.1:3000');

socket.on('confirm', function (message) {
	console.log('server confirms reception of message :');
	console.log(message);
});

// this could be probably improved (kind of callback from xmm)
socket.on('train', function (message) {
	if (message === 'ok') {
		// training worked, can request new models
	} else {
			console.error(message);
		}
});

// update model on new model reception from server :
socket.on('models', function (models) {
	console.log(models);
	var m = models.models;
	if (Array.isArray(m) && m.length > 0) {
		//gmmDecoder.setModel(m[m.length - 1]);
		console.log(models.message);
		console.log(m[m.length - 1]);
		hhmmDecoder.setModel(m[m.length - 1]);
	} else {
		console.log(models.message);
	}
});

// =================== UI interaction =================== //

recbut.addEventListener('click', function () {
	var state = recbut.className;
	if (state === 'rec-but') {
		recbut.className = 'stop-but';
		recbut.innerHTML = 'STOP';
		sendbut.disabled = true;
		// start recording some sensor and gps data
		dataRecorder.start();
	} else {
		recbut.className = 'rec-but';
		recbut.innerHTML = 'REC';
		sendbut.disabled = false;
		// stop recording data
		dataRecorder.stop();
	}
});

sendbut.addEventListener('click', function () {
	var move = movelist.options[movelist.selectedIndex].text;
	var res = confirm('You are about to send data labeled with "' + move + '". Confirm ?');
	if (res === true) {
		// send recorded data to server :
		var phrase = dataRecorder.getRecordedPhrase();
		phrase.label = move;
		phrase.date = new Date();
		socket.emit('writePhrase', phrase);
		sendbut.disabled = true;
	} else {
		sendbut.disabled = false;
	}
});

getmodelsbut.addEventListener('click', function () {
	socket.emit('trainModels');
});

// ===================== PAGE INITIALIZATION =================== //

(function () {
	var updateLikeliest = function updateLikeliest(del) {
		//let newLabel = gmmDecoder.likeliestLabel;

		if (hhmmDecoder.likeliestLabel !== likeliest.innerHTML) {
			//changeSounds(hhmmDecoder.likeliestLabel);
		}
		likeliest.innerHTML = hhmmDecoder.likeliestLabel; //newLabel;
		setTimeout(updateLikeliest, del);
	};

	updateLikeliest(200);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jbGllbnQvd2ltbC1oaG1tL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs4QkFBZSxrQkFBa0I7Ozs7MkJBQ1QsY0FBYzs7Ozt3QkFDakIsV0FBVzs7SUFBcEIsR0FBRzs7a0NBRU8seUJBQXlCOzs7OytCQUM1QixzQkFBc0I7Ozs7cUNBQ2hCLDZCQUE2Qjs7Ozt1Q0FDM0IsZ0NBQWdDOzs7O0FBRTNELElBQUksWUFBWSxHQUFHLE1BQU0sQ0FBQyxZQUFZLElBQUksTUFBTSxDQUFDLGtCQUFrQixJQUFJLFlBQVUsRUFBRSxDQUFDOzs7QUFHcEYsU0FBUyxVQUFVLEdBQUU7QUFDakIsS0FBSSxFQUFFLEdBQUMsU0FBUyxDQUFDLFNBQVM7S0FBQyxHQUFHO0tBQUMsQ0FBQyxHQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsOERBQThELENBQUMsSUFBSSxFQUFFLENBQUM7QUFDaEgsS0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDO0FBQ3JCLEtBQUcsR0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ3JDLFNBQU8sRUFBQyxJQUFJLEVBQUMsSUFBSSxFQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUUsRUFBRSxBQUFDLEVBQUMsQ0FBQztFQUN2QztBQUNMLEtBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFHLFFBQVEsRUFBQztBQUNmLEtBQUcsR0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFBO0FBQzVCLE1BQUcsR0FBRyxJQUFFLElBQUksRUFBSTtBQUFDLFVBQU8sRUFBQyxJQUFJLEVBQUMsT0FBTyxFQUFFLE9BQU8sRUFBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztHQUFDO0VBQ3ZEO0FBQ0wsRUFBQyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRSxDQUFDLENBQUMs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LElBQUksSUFBSSxFQUFFLENBQUM7QUFDekIsUUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDbkMsU0FBTyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7RUFDeEIsTUFBTTtBQUNOLFNBQU8sQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0VBQ3pCO0NBQ0QsQ0FBQyxDQUFDOztBQUdILFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBTTtBQUM1QyxPQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0NBQzNCLENBQUMsQ0FBQzs7OztBQUlILENBQUMsWUFBTTtBQUNOLEtBQU0sZUFBZSxHQUFHLFNBQWxCLGVBQWUsQ0FBSSxHQUFHLEVBQUs7OztBQUdoQyxNQUFHLFdBQVcsQ0FBQyxjQUFjLEtBQUssU0FBUyxDQUFDLFNBQVMsRUFBRTs7R0FFdEQ7QUFDRCxXQUFTLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQyxjQUFjLENBQUM7QUFDakQsWUFBVSxDQUFDLGVBQWUsRUFBRSxHQUFHLENBQUMsQ0FBQztFQUNqQyxDQUFBOztBQUVELGdCQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7Q0FDckIsQ0FBQSxFQUFHLENBQUMiLCJmaWxlIjoic3JjL2NsaWVudC93aW1sLWhobW0vaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgaW8gZnJvbSAnc29ja2V0LmlvLWNsaWVudCc7XG5pbXBvcnQgbW90aW9uSW5wdXQgZnJvbSAnbW90aW9uLWlucHV0JztcbmltcG9ydCAqIGFzIGxmbyBmcm9tICd3YXZlcy1sZm8nO1xuXG5pbXBvcnQgUmVzYW1wbGVyIGZyb20gJy4uL2NvbW1vbi9sZm8tcmVzYW1wbGVyJztcbmltcG9ydCBTZWxlY3QgZnJvbSAnLi4vY29tbW9uL2xmby1zZWxlY3QnO1xuaW1wb3J0IERhdGFSZWNvcmRlciBmcm9tICcuLi9jb21tb24vbGZvLWRhdGEtcmVjb3JkZXInO1xuaW1wb3J0IFhtbUhobW1EZWNvZGVyIGZyb20gJy4uL2NvbW1vbi9sZm8teG1tLWhobW0tZGVjb2Rlcic7XG5cbmxldCBBdWRpb0NvbnRleHQgPSB3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQgfHwgZnVuY3Rpb24oKXt9O1xuXG4vLyBmcm9tIDogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy81OTE2OTAwL2hvdy1jYW4teW91LWRldGVjdC10aGUtdmVyc2lvbi1vZi1hLWJyb3dzZXJcbmZ1bmN0aW9uIGdldEJyb3dzZXIoKXtcbiAgICB2YXIgdWE9bmF2aWdhdG9yLnVzZXJBZ2VudCx0ZW0sTT11YS5tYXRjaCgvKG9wZXJhfGNocm9tZXxzYWZhcml8ZmlyZWZveHxtc2llfHRyaWRlbnQoPz1cXC8pKVxcLz9cXHMqKFxcZCspL2kpIHx8IFtdOyBcbiAgICBpZigvdHJpZGVudC9pLnRlc3QoTVsxXSkpe1xuICAgICAgICB0ZW09L1xcYnJ2WyA6XSsoXFxkKykvZy5leGVjKHVhKSB8fCBbXTsgXG4gICAgICAgIHJldHVybiB7bmFtZTonSUUnLHZlcnNpb246KHRlbVsxXXx8JycpfTtcbiAgICAgICAgfSAgIFxuICAgIGlmKE1bMV09PT0nQ2hyb21lJyl7XG4gICAgICAgIHRlbT11YS5tYXRjaCgvXFxiT1BSXFwvKFxcZCspLylcbiAgICAgICAgaWYodGVtIT1udWxsKSAgIHtyZXR1cm4ge25hbWU6J09wZXJhJywgdmVyc2lvbjp0ZW1bMV19O31cbiAgICAgICAgfSAgIFxuICAgIE09TVsyXT8gW01bMV0sIE1bMl1dOiBbbmF2aWdhdG9yLmFwcE5hbWUsIG5hdmlnYXRvci5hcHBWZXJzaW9uLCAnLT8nXTtcbiAgICBpZigodGVtPXVhLm1hdGNoKC92ZXJzaW9uXFwvKFxcZCspL2kpKSE9bnVsbCkge00uc3BsaWNlKDEsMSx0ZW1bMV0pO31cbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogTVswXSxcbiAgICAgIHZlcnNpb246IE1bMV1cbiAgICB9O1xufVxuXG4vL2FuZCBmb3Igb3MgKGluIGNhc2UpLCBzZWUgOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzk1MTQxNzkvaG93LXRvLWZpbmQtdGhlLW9wZXJhdGluZy1zeXN0ZW0tdmVyc2lvbi11c2luZy1qYXZhc2NyaXB0XG5cbmxldCByYWRzID0gZmFsc2U7XG5pZihnZXRCcm93c2VyKCkubmFtZSA9PT0gJ0Nocm9tZScpIHtcblx0cmFkcyA9IHRydWU7XG5cdGNvbnNvbGUubG9nKCdzd2l0Y2hpbmcgdG8gcmFkcyBtb2RlIGZvciByb3RhdGlvblJhdGUnKTtcbn1cblxubGV0IHJlY2J1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyZWMtYnV0Jyk7XG5sZXQgc2VuZGJ1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzZW5kLWJ1dCcpO1xuc2VuZGJ1dC5kaXNhYmxlZCA9IHRydWU7XG4vL2xldCB0cmFpbmJ1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0cmFpbi1idXQnKTtcbmxldCBnZXRtb2RlbHNidXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2V0bW9kZWxzLWJ1dCcpO1xubGV0IG1vdmVsaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21vdmUtbGlzdCcpO1xubGV0IGxpa2VsaWVzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNsaWtlbGllc3QtbGFiZWwtZGl2Jyk7XG5cblxuLy89PT09PT09PT09PT09PT09PT09PT09PT0gTEZPcCdzID09PT09PT09PT09PT09PT09PT09PT09Ly9cblxuY29uc3QgZXZlbnRJbiA9IG5ldyBsZm8uc291cmNlcy5FdmVudEluKHtcblx0ZnJhbWVTaXplOiA2LFxuXHRjdHg6IEF1ZGlvQ29udGV4dFxufSk7XG5cbmNvbnN0IHJlc2FtcGxlciA9IG5ldyBSZXNhbXBsZXIoe30pO1xuXG5jb25zdCBkYXRhUmVjb3JkZXIgPSBuZXcgRGF0YVJlY29yZGVyKHtcblx0Y29sdW1uX25hbWVzOiBbJ2FjY2VsWCcsICdhY2NlbFknLCAnYWNjZWxaJywgJ3JvdFgnLCAncm90WScsICdyb3RaJ11cbn0pO1xuXG5jb25zdCBoaG1tRGVjb2RlciA9IG5ldyBYbW1IaG1tRGVjb2Rlcih7fSk7XG5cbmNvbnN0IHNlbGVjdCA9IG5ldyBTZWxlY3Qoe1xuXHRtb2RlOiBcInBhc3N0aHJ1XCIgLy8gYW55dGhpbmcgZWxzZSB0aGFuIFwiaW5jbHVkZVwiIG9yIFwiZXhjbHVkZVwiIHBhc3NlcyB0aHJvdWdoXG59KTtcblxuY29uc3QgaW5wdXRCcGYgPSBuZXcgbGZvLnNpbmtzLkJwZih7XG5cdHJhZGl1czogMCxcblx0bWluOiAtNCxcblx0bWF4OiA0LFxuXHRjYW52YXM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyYXdpbnB1dC1jYW52YXMnKSxcblx0ZHVyYXRpb246IDEwMDAsLy8gKiBpbnB1dENoYWluLnBhcmFtcy5ob3BTaXplICogaW5wdXRDaGFpbi5wYXJhbXMucGVyaW9kLFxuXHRjb2xvcnM6IFsnI2YwMCcsICcjMGMwJywgJyMzM2YnLCAnIzMzMycsICcjMzMzJywgJyMzMzMnXSAvLyBtYWduaXR1ZGUgOiBSZWQsIGZyZXF1ZW5jeSA6IEdyZWVuLCBwZXJpb2RpY2l0eSA6IEJsdWVcdFxufSk7XG5cbmNvbnN0IGxpa2VsaWhvb2RzU3BlY3RybyA9IG5ldyBsZm8uc2lua3MuU3BlY3Ryb2dyYW0oe1xuXHRzY2FsZTogMSxcblx0Y2FudmFzOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbGlrZWxpaG9vZHMtY2FudmFzJyksXG5cdGR1cmF0aW9uOiAxMDAwLFxuXHRjb2xvcjogJyMzMzMnXG59KTtcblxuY29uc3Qgc3RhdGVzU3BlY3RybyA9IG5ldyBsZm8uc2lua3MuU3BlY3Ryb2dyYW0oe1xuXHRzY2FsZTogMSxcblx0Y2FudmFzOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3RhdGVzLWNhbnZhcycpLFxuXHRkdXJhdGlvbjogMTAwMCxcblx0Y29sb3I6ICcjMzMzJ1xufSlcblxuZXZlbnRJbi5jb25uZWN0KHJlc2FtcGxlcik7XG5cbnJlc2FtcGxlci5jb25uZWN0KGlucHV0QnBmKTtcblxucmVzYW1wbGVyLmNvbm5lY3QoZGF0YVJlY29yZGVyKTtcblxucmVzYW1wbGVyLmNvbm5lY3QoaGhtbURlY29kZXIpO1xuaGhtbURlY29kZXIuY29ubmVjdChsaWtlbGlob29kc1NwZWN0cm8pO1xuaGhtbURlY29kZXIuY29ubmVjdChzdGF0ZXNTcGVjdHJvKTtcblxuZXZlbnRJbi5zdGFydCgpO1xuXG4vLz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbmxldCBzZW5zb3JzID0gbmV3IEFycmF5KDYpO1xuZm9yKGxldCBpPTA7IGk8NjsgaSsrKSB7XG5cdHNlbnNvcnNbaV0gPSAwO1xufVxuXG5jb25zdCBmZWVkSW5wdXRDaGFpbiA9IChtb2R1bGUpID0+IHtcblx0aWYobW9kdWxlLmlzVmFsaWQpIHtcblxuXHRcdC8vKlxuXHRcdG1vdGlvbklucHV0LmFkZExpc3RlbmVyKCdhY2NlbGVyYXRpb24nLCAodmFsKSA9PiB7XG5cdFx0XHQvL2lucHV0Q2hhaW4ucHJvY2VzcyhwZXJmb3JtYW5jZS5ub3coKSwgdmFsKTtcblx0XHRcdGZvcihsZXQgaT0wOyBpPDM7IGkrKykge1xuXHRcdFx0XHRzZW5zb3JzW2ldID0gdmFsW2ldO1xuXHRcdFx0fVxuXHRcdFx0ZXZlbnRJbi5wcm9jZXNzKHBlcmZvcm1hbmNlLm5vdygpLCBzZW5zb3JzKTtcblx0XHRcdC8vY29uc29sZS5sb2coc2Vuc29ycyk7XG5cdFx0fSk7XG5cdFx0Ly8qL1xuXG5cdFx0Ly8qXG5cdFx0bW90aW9uSW5wdXQuYWRkTGlzdGVuZXIoJ3JvdGF0aW9uUmF0ZScsICh2YWwpID0+IHtcblx0XHRcdC8vaGVyZSBjb21wdXRlIHRoZSBlcXVpdmFsZW50IG9mIFwic3BpblwiIDpcblx0XHRcdGxldCB2YWxTdGQgPSB2YWwuc2xpY2UoMCk7XG5cdFx0XHRpZihyYWRzKSB7XG5cdFx0XHRcdGZvcihsZXQgaT0wOyBpPDM7IGkrKykge1xuXHRcdFx0XHRcdHZhbFN0ZFtpXSAqPSAoMTgwL01hdGguUEkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRsZXQgc3BpbiA9IE1hdGgucG93KHZhbFN0ZFswXSp2YWxTdGRbMF0gKyB2YWxTdGRbMV0qdmFsU3RkWzFdICsgdmFsU3RkWzJdKnZhbFN0ZFsyXSwgMC41KSAqIDAuMDAzO1xuXHRcdFx0Ly9pbnB1dENoYWluLnByb2Nlc3MocGVyZm9ybWFuY2Uubm93KCksIHNwaW4pO1xuXG5cdFx0XHQvLyBUSEUgUkVBTCBDT0RFIDpcblx0XHRcdGZvcihsZXQgaT0wOyBpPDM7IGkrKykge1xuXHRcdFx0XHRzZW5zb3JzW2krM10gPSB2YWxbaV07XG5cdFx0XHR9XG5cdFx0XHRldmVudEluLnByb2Nlc3MocGVyZm9ybWFuY2Uubm93KCksIHNlbnNvcnMpO1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhzZW5zb3JzKTtcblxuXHRcdH0pO1xuXHRcdC8vKi9cblx0fVxufTtcblxuKGZ1bmN0aW9uKCkge1xuXHRtb3Rpb25JbnB1dFxuXHRcdC5pbml0KFxuXHRcdFx0J2FjY2VsZXJhdGlvbicsXG5cdFx0XHQvLydhY2NlbGVyYXRpb25JbmNsdWRpbmdHcmF2aXR5Jyxcblx0XHRcdCdyb3RhdGlvblJhdGUnXG5cdFx0XHQpXG5cdFx0LnRoZW4oKG1vZHVsZXMpID0+IHtcblx0XHRcdGNvbnN0IGFjY2VsZXJhdGlvbiA9IG1vZHVsZXNbMF07XG5cdFx0XHRjb25zdCByb3RhdGlvblJhdGUgPSBtb2R1bGVzWzFdO1xuXHRcdFx0ZmVlZElucHV0Q2hhaW4oYWNjZWxlcmF0aW9uKTtcblx0XHRcdGZlZWRJbnB1dENoYWluKHJvdGF0aW9uUmF0ZSk7XG5cdFx0fSlcblx0XHQuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIuc3RhY2spKTtcbn0pKCk7XG5cbi8vID09PT09PT09PT09PT09PT09IHNvY2tldCBvcGVyYXRpb25zID09PT09PT09PT09PT09PT09PSAvL1xuXG4vL2xldCBzb2NrZXQgPSBpby5jb25uZWN0KCdodHRwOi8vMTY5LjI1NC42OC4xMTc6MzAwMCcpO1xubGV0IHNvY2tldCA9IGlvLmNvbm5lY3QobG9jYXRpb24uaG9zdCArICcvd2ltbC1oaG1tJyk7XG4vL2xldCBzb2NrZXQgPSBpby5jb25uZWN0KCcxMjcuMC4wLjE6MzAwMCcpO1xuXG5zb2NrZXQub24oJ2NvbmZpcm0nLCAobWVzc2FnZSkgPT4ge1xuXHRjb25zb2xlLmxvZygnc2VydmVyIGNvbmZpcm1zIHJlY2VwdGlvbiBvZiBtZXNzYWdlIDonKTtcblx0Y29uc29sZS5sb2cobWVzc2FnZSk7XG59KTtcblxuLy8gdGhpcyBjb3VsZCBiZSBwcm9iYWJseSBpbXByb3ZlZCAoa2luZCBvZiBjYWxsYmFjayBmcm9tIHhtbSlcbnNvY2tldC5vbigndHJhaW4nLCAobWVzc2FnZSkgPT4ge1xuXHRpZihtZXNzYWdlID09PSAnb2snKSB7XG5cdFx0Ly8gdHJhaW5pbmcgd29ya2VkLCBjYW4gcmVxdWVzdCBuZXcgbW9kZWxzXG5cdH0gZWxzZSB7XG5cdFx0Y29uc29sZS5lcnJvcihtZXNzYWdlKTtcblx0fVxufSlcblxuLy8gdXBkYXRlIG1vZGVsIG9uIG5ldyBtb2RlbCByZWNlcHRpb24gZnJvbSBzZXJ2ZXIgOlxuc29ja2V0Lm9uKCdtb2RlbHMnLCAobW9kZWxzKSA9PiB7XG5cdGNvbnNvbGUubG9nKG1vZGVscyk7XG5cdGxldCBtID0gbW9kZWxzLm1vZGVscztcblx0aWYoQXJyYXkuaXNBcnJheShtKSAmJiBtLmxlbmd0aCA+IDApIHtcblx0XHQvL2dtbURlY29kZXIuc2V0TW9kZWwobVttLmxlbmd0aCAtIDFdKTtcblx0XHRjb25zb2xlLmxvZyhtb2RlbHMubWVzc2FnZSk7XG5cdFx0Y29uc29sZS5sb2cobVttLmxlbmd0aCAtIDFdKTtcblx0XHRoaG1tRGVjb2Rlci5zZXRNb2RlbChtW20ubGVuZ3RoIC0gMV0pO1xuXHR9IGVsc2Uge1xuXHRcdGNvbnNvbGUubG9nKG1vZGVscy5tZXNzYWdlKTtcblx0fVxufSk7XG5cbi8vID09PT09PT09PT09PT09PT09PT0gVUkgaW50ZXJhY3Rpb24gPT09PT09PT09PT09PT09PT09PSAvL1xuXG5yZWNidXQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cdGxldCBzdGF0ZSA9IHJlY2J1dC5jbGFzc05hbWU7XG5cdGlmKHN0YXRlID09PSAncmVjLWJ1dCcpIHtcblx0XHRyZWNidXQuY2xhc3NOYW1lID0gJ3N0b3AtYnV0Jztcblx0XHRyZWNidXQuaW5uZXJIVE1MID0gJ1NUT1AnXG5cdFx0c2VuZGJ1dC5kaXNhYmxlZCA9IHRydWU7XG5cdFx0Ly8gc3RhcnQgcmVjb3JkaW5nIHNvbWUgc2Vuc29yIGFuZCBncHMgZGF0YVxuXHRcdGRhdGFSZWNvcmRlci5zdGFydCgpO1xuXG5cdH0gZWxzZSB7XG5cdFx0cmVjYnV0LmNsYXNzTmFtZSA9ICdyZWMtYnV0Jztcblx0XHRyZWNidXQuaW5uZXJIVE1MID0gJ1JFQyc7XG5cdFx0c2VuZGJ1dC5kaXNhYmxlZCA9IGZhbHNlO1xuXHRcdC8vIHN0b3AgcmVjb3JkaW5nIGRhdGFcblx0XHRkYXRhUmVjb3JkZXIuc3RvcCgpO1xuXHR9XG59KTtcblxuc2VuZGJ1dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblx0bGV0IG1vdmUgPSBtb3ZlbGlzdC5vcHRpb25zW21vdmVsaXN0LnNlbGVjdGVkSW5kZXhdLnRleHQ7XG5cdGxldCByZXMgPSBjb25maXJtKCdZb3UgYXJlIGFib3V0IHRvIHNlbmQgZGF0YSBsYWJlbGVkIHdpdGggXCInICsgbW92ZSArICdcIi4gQ29uZmlybSA/Jyk7XG5cdGlmKHJlcyA9PT0gdHJ1ZSkge1xuXHRcdC8vIHNlbmQgcmVjb3JkZWQgZGF0YSB0byBzZXJ2ZXIgOlxuXHRcdGxldCBwaHJhc2UgPSBkYXRhUmVjb3JkZXIuZ2V0UmVjb3JkZWRQaHJhc2UoKTtcblx0XHRwaHJhc2UubGFiZWwgPSBtb3ZlO1xuXHRcdHBocmFzZS5kYXRlID0gbmV3IERhdGUoKTtcblx0XHRzb2NrZXQuZW1pdCgnd3JpdGVQaHJhc2UnLCBwaHJhc2UpO1xuXHRcdHNlbmRidXQuZGlzYWJsZWQgPSB0cnVlO1xuXHR9IGVsc2Uge1xuXHRcdHNlbmRidXQuZGlzYWJsZWQgPSBmYWxzZTtcblx0fVxufSk7XG5cblxuZ2V0bW9kZWxzYnV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuXHRzb2NrZXQuZW1pdCgndHJhaW5Nb2RlbHMnKTtcbn0pO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT0gUEFHRSBJTklUSUFMSVpBVElPTiA9PT09PT09PT09PT09PT09PT09IC8vXG5cbigoKSA9PiB7XG5cdGNvbnN0IHVwZGF0ZUxpa2VsaWVzdCA9IChkZWwpID0+IHtcblx0XHQvL2xldCBuZXdMYWJlbCA9IGdtbURlY29kZXIubGlrZWxpZXN0TGFiZWw7XG5cblx0XHRpZihoaG1tRGVjb2Rlci5saWtlbGllc3RMYWJlbCAhPT0gbGlrZWxpZXN0LmlubmVySFRNTCkge1xuXHRcdFx0Ly9jaGFuZ2VTb3VuZHMoaGhtbURlY29kZXIubGlrZWxpZXN0TGFiZWwpO1xuXHRcdH1cblx0XHRsaWtlbGllc3QuaW5uZXJIVE1MID0gaGhtbURlY29kZXIubGlrZWxpZXN0TGFiZWw7Ly9uZXdMYWJlbDtcblx0XHRzZXRUaW1lb3V0KHVwZGF0ZUxpa2VsaWVzdCwgZGVsKTtcblx0fVxuXG5cdHVwZGF0ZUxpa2VsaWVzdCgyMDApO1xufSkoKTtcbiJdfQ==