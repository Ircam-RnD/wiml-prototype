'use strict';

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _socketIoClient = require('socket.io-client');

var _socketIoClient2 = _interopRequireDefault(_socketIoClient);

var _motionInput = require('motion-input');

var _motionInput2 = _interopRequireDefault(_motionInput);

var _wavesLfo = require('waves-lfo');

var lfo = _interopRequireWildcard(_wavesLfo);

var _commonLfoResampler = require('../common/lfo-resampler');

var _commonLfoResampler2 = _interopRequireDefault(_commonLfoResampler);

var _commonLfoSelect = require('../common/lfo-select');

var _commonLfoSelect2 = _interopRequireDefault(_commonLfoSelect);

var _commonLfoDataRecorder = require('../common/lfo-data-recorder');

var _commonLfoDataRecorder2 = _interopRequireDefault(_commonLfoDataRecorder);

var _commonLfoXmmHhmmDecoder = require('../common/lfo-xmm-hhmm-decoder');

var _commonLfoXmmHhmmDecoder2 = _interopRequireDefault(_commonLfoXmmHhmmDecoder);

var AudioContext = window.AudioContext || window.webkitAudioContext || function () {};

// from : http://stackoverflow.com/questions/5916900/how-can-you-detect-the-version-of-a-browser
function getBrowser() {
	var ua = navigator.userAgent,
	    tem,
	    M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
	if (/trident/i.test(M[1])) {
		tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
		return { name: 'IE', version: tem[1] || '' };
	}
	if (M[1] === 'Chrome') {
		tem = ua.match(/\bOPR\/(\d+)/);
		if (tem != null) {
			return { name: 'Opera', version: tem[1] };
		}
	}
	M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];
	if ((tem = ua.match(/version\/(\d+)/i)) != null) {
		M.splice(1, 1, tem[1]);
	}
	return {
		name: M[0],
		version: M[1]
	};
}

//and for os (in case), see : http://stackoverflow.com/questions/9514179/how-to-find-the-operating-system-version-using-javascript

var rads = false;
if (getBrowser().name === 'Chrome') {
	rads = true;
	console.log('switching to rads mode for rotationRate');
}

var recbut = document.querySelector('#rec-but');
var sendbut = document.querySelector('#send-but');
sendbut.disabled = true;
//let trainbut = document.querySelector('#train-but');
var getmodelsbut = document.querySelector('#getmodels-but');
var movelist = document.querySelector('#move-list');
var likeliest = document.querySelector('#likeliest-label-div');

//======================== LFOp's =======================//

var eventIn = new lfo.sources.EventIn({
	frameSize: 6,
	ctx: AudioContext
});

var resampler = new _commonLfoResampler2['default']({});

var dataRecorder = new _commonLfoDataRecorder2['default']({
	column_names: ['accelX', 'accelY', 'accelZ', 'rotX', 'rotY', 'rotZ']
});

var hhmmDecoder = new _commonLfoXmmHhmmDecoder2['default']({});

var select = new _commonLfoSelect2['default']({
	mode: "passthru" // anything else than "include" or "exclude" passes through
});

var inputBpf = new lfo.sinks.Bpf({
	radius: 0,
	min: -4,
	max: 4,
	canvas: document.querySelector('#rawinput-canvas'),
	duration: 1000, // * inputChain.params.hopSize * inputChain.params.period,
	colors: ['#f00', '#0c0', '#33f', '#333', '#333', '#333'] // magnitude : Red, frequency : Green, periodicity : Blue	
});

var likelihoodsSpectro = new lfo.sinks.Spectrogram({
	scale: 1,
	min: 0,
	max: 1,
	canvas: document.querySelector('#likelihoods-canvas'),
	duration: 1000,
	color: '#333'
});

var statesSpectro = new lfo.sinks.Spectrogram({
	scale: 1,
	canvas: document.querySelector('#states-canvas'),
	duration: 1000,
	color: '#333'
});

eventIn.connect(resampler);

resampler.connect(inputBpf);

resampler.connect(dataRecorder);

resampler.connect(hhmmDecoder);
hhmmDecoder.connect(likelihoodsSpectro);
hhmmDecoder.connect(statesSpectro);

eventIn.start();

//======================================================//

var sensors = new Array(6);
for (var i = 0; i < 6; i++) {
	sensors[i] = 0;
}

var feedInputChain = function feedInputChain(module) {
	if (module.isValid) {

		//*
		_motionInput2['default'].addListener('acceleration', function (val) {
			//inputChain.process(performance.now(), val);
			for (var i = 0; i < 3; i++) {
				sensors[i] = val[i];
			}
			eventIn.process(performance.now(), sensors);
			//console.log(sensors);
		});
		//*/

		//*
		_motionInput2['default'].addListener('rotationRate', function (val) {
			//here compute the equivalent of "spin" :
			var valStd = val.slice(0);
			if (rads) {
				for (var i = 0; i < 3; i++) {
					valStd[i] *= 180 / Math.PI;
				}
			}
			var spin = Math.pow(valStd[0] * valStd[0] + valStd[1] * valStd[1] + valStd[2] * valStd[2], 0.5) * 0.003;
			//inputChain.process(performance.now(), spin);

			// THE REAL CODE :
			for (var i = 0; i < 3; i++) {
				sensors[i + 3] = val[i];
			}
			eventIn.process(performance.now(), sensors);
			//console.log(sensors);
		});
		//*/
	}
};

(function () {
	_motionInput2['default'].init('acceleration',
	//'accelerationIncludingGravity',
	'rotationRate').then(function (modules) {
		var acceleration = modules[0];
		var rotationRate = modules[1];
		feedInputChain(acceleration);
		feedInputChain(rotationRate);
	})['catch'](function (err) {
		return console.error(err.stack);
	});
})();

// ================= socket operations ================== //

//let socket = io.connect('http://169.254.68.117:3000');
var socket = _socketIoClient2['default'].connect(location.host + '/wiml-hhmm');
//let socket = io.connect('127.0.0.1:3000');

socket.on('confirm', function (message) {
	console.log('server confirms reception of message :');
	console.log(message);
});

// this could be probably improved (kind of callback from xmm)
socket.on('train', function (message) {
	if (message === 'ok') {
		// training worked, can request new models
	} else {
			console.error(message);
		}
});

// update model on new model reception from server :
socket.on('models', function (models) {
	console.log(models);
	var m = models.models;
	if (Array.isArray(m) && m.length > 0) {
		//gmmDecoder.setModel(m[m.length - 1]);
		console.log(models.message);
		console.log(m[m.length - 1]);
		hhmmDecoder.setModel(m[m.length - 1]);
	} else {
		console.log(models.message);
	}
});

// =================== UI interaction =================== //

recbut.addEventListener('click', function () {
	var state = recbut.className;
	if (state === 'rec-but') {
		recbut.className = 'stop-but';
		recbut.innerHTML = 'STOP';
		sendbut.disabled = true;
		// start recording some sensor and gps data
		dataRecorder.start();
	} else {
		recbut.className = 'rec-but';
		recbut.innerHTML = 'REC';
		sendbut.disabled = false;
		// stop recording data
		dataRecorder.stop();
	}
});

sendbut.addEventListener('click', function () {
	var move = movelist.options[movelist.selectedIndex].text;
	var res = confirm('You are about to send data labeled with "' + move + '". Confirm ?');
	if (res === true) {
		// send recorded data to server :
		var phrase = dataRecorder.getRecordedPhrase();
		phrase.label = move;
		phrase.date = new Date();
		socket.emit('writePhrase', phrase);
		sendbut.disabled = true;
	} else {
		sendbut.disabled = false;
	}
});

getmodelsbut.addEventListener('click', function () {
	socket.emit('trainModels');
});

// ===================== PAGE INITIALIZATION =================== //

(function () {
	var updateLikeliest = function updateLikeliest(del) {
		//let newLabel = gmmDecoder.likeliestLabel;

		if (hhmmDecoder.likeliestLabel !== likeliest.innerHTML) {
			//changeSounds(hhmmDecoder.likeliestLabel);
		}
		likeliest.innerHTML = hhmmDecoder.likeliestLabel; //newLabel;
		setTimeout(updateLikeliest, del);
	};

	updateLikeliest(200);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jbGllbnQvd2ltbC1oaG1tL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs4QkFBZSxrQkFBa0I7Ozs7MkJBQ1QsY0FBYzs7Ozt3QkFDakIsV0FBVzs7SUFBcEIsR0FBRzs7a0NBRU8seUJBQXlCOzs7OytCQUM1QixzQkFBc0I7Ozs7cUNBQ2hCLDZCQUE2Qjs7Ozt1Q0FDM0IsZ0NBQWdDOzs7O0FBRTNELElBQUksWUFBWSxHQUFHLE1BQU0sQ0FBQyxZQUFZLElBQUksTUFBTSxDQUFDLGtCQUFrQixJQUFJLFlBQVUsRUFBRSxDQUFDOzs7QUFHcEYsU0FBUyxVQUFVLEdBQUU7QUFDakIsS0FBSSxFQUFFLEdBQUMsU0FBUyxDQUFDLFNBQVM7S0FBQyxHQUFHO0tBQUMsQ0FBQyxHQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsOERBQThELENBQUMsSUFBSSxFQUFFLENBQUM7QUFDaEgsS0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDO0FBQ3JCLEtBQUcsR0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ3JDLFNBQU8sRUFBQyxJQUFJLEVBQUMsSUFBSSxFQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUUsRUFBRSxBQUFDLEVBQUMsQ0FBQztFQUN2QztBQUNMLEtBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFHLFFBQVEsRUFBQztBQUNmLEtBQUcsR0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFBO0FBQzVCLE1BQUcsR0FBRyxJQUFFLElBQUksRUFBSTtBQUFDLFVBQU8sRUFBQyxJQUFJLEVBQUMsT0FBTyxFQUFFLE9BQU8sRUFBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztHQUFDO0VBQ3ZEO0FBQ0wsRUFBQyxHQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRSxDQUFDLENBQUMs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R0FBRyxJQUFJLENBQUM7QUFDcEIsUUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0FBQ3pCLFFBQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQ25DLFNBQU8sQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO0VBQ3hCLE1BQU07QUFDTixTQUFPLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztFQUN6QjtDQUNELENBQUMsQ0FBQzs7QUFHSCxZQUFZLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFlBQU07QUFDNUMsT0FBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztDQUMzQixDQUFDLENBQUM7Ozs7QUFJSCxDQUFDLFlBQU07QUFDTixLQUFNLGVBQWUsR0FBRyxTQUFsQixlQUFlLENBQUksR0FBRyxFQUFLOzs7QUFHaEMsTUFBRyxXQUFXLENBQUMsY0FBYyxLQUFLLFNBQVMsQ0FBQyxTQUFTLEVBQUU7O0dBRXREO0FBQ0QsV0FBUyxDQUFDLFNBQVMsR0FBRyxXQUFXLENBQUMsY0FBYyxDQUFDO0FBQ2pELFlBQVUsQ0FBQyxlQUFlLEVBQUUsR0FBRyxDQUFDLENBQUM7RUFDakMsQ0FBQTs7QUFFRCxnQkFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0NBQ3JCLENBQUEsRUFBRyxDQUFDIiwiZmlsZSI6InNyYy9jbGllbnQvd2ltbC1oaG1tL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGlvIGZyb20gJ3NvY2tldC5pby1jbGllbnQnO1xuaW1wb3J0IG1vdGlvbklucHV0IGZyb20gJ21vdGlvbi1pbnB1dCc7XG5pbXBvcnQgKiBhcyBsZm8gZnJvbSAnd2F2ZXMtbGZvJztcblxuaW1wb3J0IFJlc2FtcGxlciBmcm9tICcuLi9jb21tb24vbGZvLXJlc2FtcGxlcic7XG5pbXBvcnQgU2VsZWN0IGZyb20gJy4uL2NvbW1vbi9sZm8tc2VsZWN0JztcbmltcG9ydCBEYXRhUmVjb3JkZXIgZnJvbSAnLi4vY29tbW9uL2xmby1kYXRhLXJlY29yZGVyJztcbmltcG9ydCBYbW1IaG1tRGVjb2RlciBmcm9tICcuLi9jb21tb24vbGZvLXhtbS1oaG1tLWRlY29kZXInO1xuXG5sZXQgQXVkaW9Db250ZXh0ID0gd2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0IHx8IGZ1bmN0aW9uKCl7fTtcblxuLy8gZnJvbSA6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNTkxNjkwMC9ob3ctY2FuLXlvdS1kZXRlY3QtdGhlLXZlcnNpb24tb2YtYS1icm93c2VyXG5mdW5jdGlvbiBnZXRCcm93c2VyKCl7XG4gICAgdmFyIHVhPW5hdmlnYXRvci51c2VyQWdlbnQsdGVtLE09dWEubWF0Y2goLyhvcGVyYXxjaHJvbWV8c2FmYXJpfGZpcmVmb3h8bXNpZXx0cmlkZW50KD89XFwvKSlcXC8/XFxzKihcXGQrKS9pKSB8fCBbXTsgXG4gICAgaWYoL3RyaWRlbnQvaS50ZXN0KE1bMV0pKXtcbiAgICAgICAgdGVtPS9cXGJydlsgOl0rKFxcZCspL2cuZXhlYyh1YSkgfHwgW107IFxuICAgICAgICByZXR1cm4ge25hbWU6J0lFJyx2ZXJzaW9uOih0ZW1bMV18fCcnKX07XG4gICAgICAgIH0gICBcbiAgICBpZihNWzFdPT09J0Nocm9tZScpe1xuICAgICAgICB0ZW09dWEubWF0Y2goL1xcYk9QUlxcLyhcXGQrKS8pXG4gICAgICAgIGlmKHRlbSE9bnVsbCkgICB7cmV0dXJuIHtuYW1lOidPcGVyYScsIHZlcnNpb246dGVtWzFdfTt9XG4gICAgICAgIH0gICBcbiAgICBNPU1bMl0/IFtNWzFdLCBNWzJdXTogW25hdmlnYXRvci5hcHBOYW1lLCBuYXZpZ2F0b3IuYXBwVmVyc2lvbiwgJy0/J107XG4gICAgaWYoKHRlbT11YS5tYXRjaCgvdmVyc2lvblxcLyhcXGQrKS9pKSkhPW51bGwpIHtNLnNwbGljZSgxLDEsdGVtWzFdKTt9XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IE1bMF0sXG4gICAgICB2ZXJzaW9uOiBNWzFdXG4gICAgfTtcbn1cblxuLy9hbmQgZm9yIG9zIChpbiBjYXNlKSwgc2VlIDogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy85NTE0MTc5L2hvdy10by1maW5kLXRoZS1vcGVyYXRpbmctc3lzdGVtLXZlcnNpb24tdXNpbmctamF2YXNjcmlwdFxuXG5sZXQgcmFkcyA9IGZhbHNlO1xuaWYoZ2V0QnJvd3NlcigpLm5hbWUgPT09ICdDaHJvbWUnKSB7XG5cdHJhZHMgPSB0cnVlO1xuXHRjb25zb2xlLmxvZygnc3dpdGNoaW5nIHRvIHJhZHMgbW9kZSBmb3Igcm90YXRpb25SYXRlJyk7XG59XG5cbmxldCByZWNidXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmVjLWJ1dCcpO1xubGV0IHNlbmRidXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2VuZC1idXQnKTtcbnNlbmRidXQuZGlzYWJsZWQgPSB0cnVlO1xuLy9sZXQgdHJhaW5idXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdHJhaW4tYnV0Jyk7XG5sZXQgZ2V0bW9kZWxzYnV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2dldG1vZGVscy1idXQnKTtcbmxldCBtb3ZlbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNtb3ZlLWxpc3QnKTtcbmxldCBsaWtlbGllc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbGlrZWxpZXN0LWxhYmVsLWRpdicpO1xuXG5cbi8vPT09PT09PT09PT09PT09PT09PT09PT09IExGT3AncyA9PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbmNvbnN0IGV2ZW50SW4gPSBuZXcgbGZvLnNvdXJjZXMuRXZlbnRJbih7XG5cdGZyYW1lU2l6ZTogNixcblx0Y3R4OiBBdWRpb0NvbnRleHRcbn0pO1xuXG5jb25zdCByZXNhbXBsZXIgPSBuZXcgUmVzYW1wbGVyKHt9KTtcblxuY29uc3QgZGF0YVJlY29yZGVyID0gbmV3IERhdGFSZWNvcmRlcih7XG5cdGNvbHVtbl9uYW1lczogWydhY2NlbFgnLCAnYWNjZWxZJywgJ2FjY2VsWicsICdyb3RYJywgJ3JvdFknLCAncm90WiddXG59KTtcblxuY29uc3QgaGhtbURlY29kZXIgPSBuZXcgWG1tSGhtbURlY29kZXIoe30pO1xuXG5jb25zdCBzZWxlY3QgPSBuZXcgU2VsZWN0KHtcblx0bW9kZTogXCJwYXNzdGhydVwiIC8vIGFueXRoaW5nIGVsc2UgdGhhbiBcImluY2x1ZGVcIiBvciBcImV4Y2x1ZGVcIiBwYXNzZXMgdGhyb3VnaFxufSk7XG5cbmNvbnN0IGlucHV0QnBmID0gbmV3IGxmby5zaW5rcy5CcGYoe1xuXHRyYWRpdXM6IDAsXG5cdG1pbjogLTQsXG5cdG1heDogNCxcblx0Y2FudmFzOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmF3aW5wdXQtY2FudmFzJyksXG5cdGR1cmF0aW9uOiAxMDAwLC8vICogaW5wdXRDaGFpbi5wYXJhbXMuaG9wU2l6ZSAqIGlucHV0Q2hhaW4ucGFyYW1zLnBlcmlvZCxcblx0Y29sb3JzOiBbJyNmMDAnLCAnIzBjMCcsICcjMzNmJywgJyMzMzMnLCAnIzMzMycsICcjMzMzJ10gLy8gbWFnbml0dWRlIDogUmVkLCBmcmVxdWVuY3kgOiBHcmVlbiwgcGVyaW9kaWNpdHkgOiBCbHVlXHRcbn0pO1xuXG5jb25zdCBsaWtlbGlob29kc1NwZWN0cm8gPSBuZXcgbGZvLnNpbmtzLlNwZWN0cm9ncmFtKHtcblx0c2NhbGU6IDEsXG5cdG1pbjogMCxcblx0bWF4OiAxLFxuXHRjYW52YXM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNsaWtlbGlob29kcy1jYW52YXMnKSxcblx0ZHVyYXRpb246IDEwMDAsXG5cdGNvbG9yOiAnIzMzMydcbn0pO1xuXG5jb25zdCBzdGF0ZXNTcGVjdHJvID0gbmV3IGxmby5zaW5rcy5TcGVjdHJvZ3JhbSh7XG5cdHNjYWxlOiAxLFxuXHRjYW52YXM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzdGF0ZXMtY2FudmFzJyksXG5cdGR1cmF0aW9uOiAxMDAwLFxuXHRjb2xvcjogJyMzMzMnXG59KVxuXG5ldmVudEluLmNvbm5lY3QocmVzYW1wbGVyKTtcblxucmVzYW1wbGVyLmNvbm5lY3QoaW5wdXRCcGYpO1xuXG5yZXNhbXBsZXIuY29ubmVjdChkYXRhUmVjb3JkZXIpO1xuXG5yZXNhbXBsZXIuY29ubmVjdChoaG1tRGVjb2Rlcik7XG5oaG1tRGVjb2Rlci5jb25uZWN0KGxpa2VsaWhvb2RzU3BlY3Rybyk7XG5oaG1tRGVjb2Rlci5jb25uZWN0KHN0YXRlc1NwZWN0cm8pO1xuXG5ldmVudEluLnN0YXJ0KCk7XG5cbi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cblxubGV0IHNlbnNvcnMgPSBuZXcgQXJyYXkoNik7XG5mb3IobGV0IGk9MDsgaTw2OyBpKyspIHtcblx0c2Vuc29yc1tpXSA9IDA7XG59XG5cbmNvbnN0IGZlZWRJbnB1dENoYWluID0gKG1vZHVsZSkgPT4ge1xuXHRpZihtb2R1bGUuaXNWYWxpZCkge1xuXG5cdFx0Ly8qXG5cdFx0bW90aW9uSW5wdXQuYWRkTGlzdGVuZXIoJ2FjY2VsZXJhdGlvbicsICh2YWwpID0+IHtcblx0XHRcdC8vaW5wdXRDaGFpbi5wcm9jZXNzKHBlcmZvcm1hbmNlLm5vdygpLCB2YWwpO1xuXHRcdFx0Zm9yKGxldCBpPTA7IGk8MzsgaSsrKSB7XG5cdFx0XHRcdHNlbnNvcnNbaV0gPSB2YWxbaV07XG5cdFx0XHR9XG5cdFx0XHRldmVudEluLnByb2Nlc3MocGVyZm9ybWFuY2Uubm93KCksIHNlbnNvcnMpO1xuXHRcdFx0Ly9jb25zb2xlLmxvZyhzZW5zb3JzKTtcblx0XHR9KTtcblx0XHQvLyovXG5cblx0XHQvLypcblx0XHRtb3Rpb25JbnB1dC5hZGRMaXN0ZW5lcigncm90YXRpb25SYXRlJywgKHZhbCkgPT4ge1xuXHRcdFx0Ly9oZXJlIGNvbXB1dGUgdGhlIGVxdWl2YWxlbnQgb2YgXCJzcGluXCIgOlxuXHRcdFx0bGV0IHZhbFN0ZCA9IHZhbC5zbGljZSgwKTtcblx0XHRcdGlmKHJhZHMpIHtcblx0XHRcdFx0Zm9yKGxldCBpPTA7IGk8MzsgaSsrKSB7XG5cdFx0XHRcdFx0dmFsU3RkW2ldICo9ICgxODAvTWF0aC5QSSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGxldCBzcGluID0gTWF0aC5wb3codmFsU3RkWzBdKnZhbFN0ZFswXSArIHZhbFN0ZFsxXSp2YWxTdGRbMV0gKyB2YWxTdGRbMl0qdmFsU3RkWzJdLCAwLjUpICogMC4wMDM7XG5cdFx0XHQvL2lucHV0Q2hhaW4ucHJvY2VzcyhwZXJmb3JtYW5jZS5ub3coKSwgc3Bpbik7XG5cblx0XHRcdC8vIFRIRSBSRUFMIENPREUgOlxuXHRcdFx0Zm9yKGxldCBpPTA7IGk8MzsgaSsrKSB7XG5cdFx0XHRcdHNlbnNvcnNbaSszXSA9IHZhbFtpXTtcblx0XHRcdH1cblx0XHRcdGV2ZW50SW4ucHJvY2VzcyhwZXJmb3JtYW5jZS5ub3coKSwgc2Vuc29ycyk7XG5cdFx0XHQvL2NvbnNvbGUubG9nKHNlbnNvcnMpO1xuXG5cdFx0fSk7XG5cdFx0Ly8qL1xuXHR9XG59O1xuXG4oZnVuY3Rpb24oKSB7XG5cdG1vdGlvbklucHV0XG5cdFx0LmluaXQoXG5cdFx0XHQnYWNjZWxlcmF0aW9uJyxcblx0XHRcdC8vJ2FjY2VsZXJhdGlvbkluY2x1ZGluZ0dyYXZpdHknLFxuXHRcdFx0J3JvdGF0aW9uUmF0ZSdcblx0XHRcdClcblx0XHQudGhlbigobW9kdWxlcykgPT4ge1xuXHRcdFx0Y29uc3QgYWNjZWxlcmF0aW9uID0gbW9kdWxlc1swXTtcblx0XHRcdGNvbnN0IHJvdGF0aW9uUmF0ZSA9IG1vZHVsZXNbMV07XG5cdFx0XHRmZWVkSW5wdXRDaGFpbihhY2NlbGVyYXRpb24pO1xuXHRcdFx0ZmVlZElucHV0Q2hhaW4ocm90YXRpb25SYXRlKTtcblx0XHR9KVxuXHRcdC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVyci5zdGFjaykpO1xufSkoKTtcblxuLy8gPT09PT09PT09PT09PT09PT0gc29ja2V0IG9wZXJhdGlvbnMgPT09PT09PT09PT09PT09PT09IC8vXG5cbi8vbGV0IHNvY2tldCA9IGlvLmNvbm5lY3QoJ2h0dHA6Ly8xNjkuMjU0LjY4LjExNzozMDAwJyk7XG5sZXQgc29ja2V0ID0gaW8uY29ubmVjdChsb2NhdGlvbi5ob3N0ICsgJy93aW1sLWhobW0nKTtcbi8vbGV0IHNvY2tldCA9IGlvLmNvbm5lY3QoJzEyNy4wLjAuMTozMDAwJyk7XG5cbnNvY2tldC5vbignY29uZmlybScsIChtZXNzYWdlKSA9PiB7XG5cdGNvbnNvbGUubG9nKCdzZXJ2ZXIgY29uZmlybXMgcmVjZXB0aW9uIG9mIG1lc3NhZ2UgOicpO1xuXHRjb25zb2xlLmxvZyhtZXNzYWdlKTtcbn0pO1xuXG4vLyB0aGlzIGNvdWxkIGJlIHByb2JhYmx5IGltcHJvdmVkIChraW5kIG9mIGNhbGxiYWNrIGZyb20geG1tKVxuc29ja2V0Lm9uKCd0cmFpbicsIChtZXNzYWdlKSA9PiB7XG5cdGlmKG1lc3NhZ2UgPT09ICdvaycpIHtcblx0XHQvLyB0cmFpbmluZyB3b3JrZWQsIGNhbiByZXF1ZXN0IG5ldyBtb2RlbHNcblx0fSBlbHNlIHtcblx0XHRjb25zb2xlLmVycm9yKG1lc3NhZ2UpO1xuXHR9XG59KVxuXG4vLyB1cGRhdGUgbW9kZWwgb24gbmV3IG1vZGVsIHJlY2VwdGlvbiBmcm9tIHNlcnZlciA6XG5zb2NrZXQub24oJ21vZGVscycsIChtb2RlbHMpID0+IHtcblx0Y29uc29sZS5sb2cobW9kZWxzKTtcblx0bGV0IG0gPSBtb2RlbHMubW9kZWxzO1xuXHRpZihBcnJheS5pc0FycmF5KG0pICYmIG0ubGVuZ3RoID4gMCkge1xuXHRcdC8vZ21tRGVjb2Rlci5zZXRNb2RlbChtW20ubGVuZ3RoIC0gMV0pO1xuXHRcdGNvbnNvbGUubG9nKG1vZGVscy5tZXNzYWdlKTtcblx0XHRjb25zb2xlLmxvZyhtW20ubGVuZ3RoIC0gMV0pO1xuXHRcdGhobW1EZWNvZGVyLnNldE1vZGVsKG1bbS5sZW5ndGggLSAxXSk7XG5cdH0gZWxzZSB7XG5cdFx0Y29uc29sZS5sb2cobW9kZWxzLm1lc3NhZ2UpO1xuXHR9XG59KTtcblxuLy8gPT09PT09PT09PT09PT09PT09PSBVSSBpbnRlcmFjdGlvbiA9PT09PT09PT09PT09PT09PT09IC8vXG5cbnJlY2J1dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblx0bGV0IHN0YXRlID0gcmVjYnV0LmNsYXNzTmFtZTtcblx0aWYoc3RhdGUgPT09ICdyZWMtYnV0Jykge1xuXHRcdHJlY2J1dC5jbGFzc05hbWUgPSAnc3RvcC1idXQnO1xuXHRcdHJlY2J1dC5pbm5lckhUTUwgPSAnU1RPUCdcblx0XHRzZW5kYnV0LmRpc2FibGVkID0gdHJ1ZTtcblx0XHQvLyBzdGFydCByZWNvcmRpbmcgc29tZSBzZW5zb3IgYW5kIGdwcyBkYXRhXG5cdFx0ZGF0YVJlY29yZGVyLnN0YXJ0KCk7XG5cblx0fSBlbHNlIHtcblx0XHRyZWNidXQuY2xhc3NOYW1lID0gJ3JlYy1idXQnO1xuXHRcdHJlY2J1dC5pbm5lckhUTUwgPSAnUkVDJztcblx0XHRzZW5kYnV0LmRpc2FibGVkID0gZmFsc2U7XG5cdFx0Ly8gc3RvcCByZWNvcmRpbmcgZGF0YVxuXHRcdGRhdGFSZWNvcmRlci5zdG9wKCk7XG5cdH1cbn0pO1xuXG5zZW5kYnV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuXHRsZXQgbW92ZSA9IG1vdmVsaXN0Lm9wdGlvbnNbbW92ZWxpc3Quc2VsZWN0ZWRJbmRleF0udGV4dDtcblx0bGV0IHJlcyA9IGNvbmZpcm0oJ1lvdSBhcmUgYWJvdXQgdG8gc2VuZCBkYXRhIGxhYmVsZWQgd2l0aCBcIicgKyBtb3ZlICsgJ1wiLiBDb25maXJtID8nKTtcblx0aWYocmVzID09PSB0cnVlKSB7XG5cdFx0Ly8gc2VuZCByZWNvcmRlZCBkYXRhIHRvIHNlcnZlciA6XG5cdFx0bGV0IHBocmFzZSA9IGRhdGFSZWNvcmRlci5nZXRSZWNvcmRlZFBocmFzZSgpO1xuXHRcdHBocmFzZS5sYWJlbCA9IG1vdmU7XG5cdFx0cGhyYXNlLmRhdGUgPSBuZXcgRGF0ZSgpO1xuXHRcdHNvY2tldC5lbWl0KCd3cml0ZVBocmFzZScsIHBocmFzZSk7XG5cdFx0c2VuZGJ1dC5kaXNhYmxlZCA9IHRydWU7XG5cdH0gZWxzZSB7XG5cdFx0c2VuZGJ1dC5kaXNhYmxlZCA9IGZhbHNlO1xuXHR9XG59KTtcblxuXG5nZXRtb2RlbHNidXQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cdHNvY2tldC5lbWl0KCd0cmFpbk1vZGVscycpO1xufSk7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PSBQQUdFIElOSVRJQUxJWkFUSU9OID09PT09PT09PT09PT09PT09PT0gLy9cblxuKCgpID0+IHtcblx0Y29uc3QgdXBkYXRlTGlrZWxpZXN0ID0gKGRlbCkgPT4ge1xuXHRcdC8vbGV0IG5ld0xhYmVsID0gZ21tRGVjb2Rlci5saWtlbGllc3RMYWJlbDtcblxuXHRcdGlmKGhobW1EZWNvZGVyLmxpa2VsaWVzdExhYmVsICE9PSBsaWtlbGllc3QuaW5uZXJIVE1MKSB7XG5cdFx0XHQvL2NoYW5nZVNvdW5kcyhoaG1tRGVjb2Rlci5saWtlbGllc3RMYWJlbCk7XG5cdFx0fVxuXHRcdGxpa2VsaWVzdC5pbm5lckhUTUwgPSBoaG1tRGVjb2Rlci5saWtlbGllc3RMYWJlbDsvL25ld0xhYmVsO1xuXHRcdHNldFRpbWVvdXQodXBkYXRlTGlrZWxpZXN0LCBkZWwpO1xuXHR9XG5cblx0dXBkYXRlTGlrZWxpZXN0KDIwMCk7XG59KSgpO1xuIl19